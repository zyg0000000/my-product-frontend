# è¿”ç‚¹åŠŸèƒ½å¼€å‘è®¡åˆ’ (Rebate Feature Development Plan)

## ğŸ¯ å…³é”®å®ç°è¦ç‚¹ Key Implementation Points

### é‡ç”Ÿè¾¾äººæ ¸å¿ƒé€»è¾‘
1. **è¯†åˆ«æ–¹å¼**: `agencyId === AGENCY_INDIVIDUAL_ID`
2. **é»˜è®¤è¿”ç‚¹**: æ–°å»ºæ—¶è‡ªåŠ¨è®¾ç½®ä¸º **0%**
3. **è¿”ç‚¹å±æ€§**: å§‹ç»ˆä¸º"ç‹¬ç«‹è®¾ç½®"
4. **å¼¹çª—æ˜¾ç¤º**: "å•†ä¸šå½’å±ï¼šé‡ç”Ÿè¾¾äºº"
5. **è°ƒæ•´æ–¹å¼**: Tabåˆ‡æ¢ï¼ˆæ‰‹åŠ¨è°ƒæ•´ | é˜¶æ¢¯è§„åˆ™-é¢„ç•™ï¼‰
6. **é˜¶æ¢¯è§„åˆ™**: æŒ‰ä¸ªäººåˆä½œé‡ç»Ÿè®¡

### æœºæ„è¾¾äººæ ¸å¿ƒé€»è¾‘
1. **è¯†åˆ«æ–¹å¼**: `agencyId !== AGENCY_INDIVIDUAL_ID`
2. **é»˜è®¤æ¨¡å¼**: æ–°å»ºæ—¶é»˜è®¤ä¸º**åŒæ­¥æ¨¡å¼**
3. **è¿”ç‚¹å±æ€§**:
   - åŒæ­¥æ¨¡å¼æ˜¾ç¤º"æœºæ„åŒæ­¥"
   - ç‹¬ç«‹æ¨¡å¼æ˜¾ç¤º"ç‹¬ç«‹è®¾ç½®"
4. **æ¨¡å¼åˆ‡æ¢**: å½“å‰é…ç½®é¡µæä¾›å¼€å…³åˆ‡æ¢ç‹¬ç«‹/åŒæ­¥
5. **ç‹¬ç«‹æ¨¡å¼**: ä¸é‡ç”Ÿè¾¾äººå®Œå…¨ç›¸åŒçš„åŠŸèƒ½ï¼Œåªæ˜¯ä¿ç•™agencyIdä¾¿äºç»Ÿè®¡
6. **Tabæ˜¾ç¤ºé€»è¾‘**:
   - åŒæ­¥æ¨¡å¼ï¼šæ˜¾ç¤ºæœºæ„åŒæ­¥Tab
   - ç‹¬ç«‹æ¨¡å¼ï¼šæ˜¾ç¤ºæ‰‹åŠ¨è°ƒæ•´Tabï¼ˆåŒé‡ç”Ÿè¾¾äººï¼‰

### æœºæ„ç®¡ç†è¿”ç‚¹é…ç½®
1. **å…¥å£**: æœºæ„ç®¡ç†åˆ—è¡¨é¡µ"è¿”ç‚¹ç®¡ç†"æŒ‰é’®
2. **æ›´æ–°æœºåˆ¶**: æ‰‹åŠ¨è§¦å‘æŒ‰é’®åŒæ­¥ç»™æ‰€æœ‰åŒæ­¥æ¨¡å¼è¾¾äºº
3. **å½±å“èŒƒå›´**: ä»…å½±å“é€‰æ‹©"åŒæ­¥æ¨¡å¼"çš„è¯¥æœºæ„è¾¾äºº
4. **é˜¶æ¢¯è§„åˆ™**: æŒ‰æœºæ„æ€»åˆä½œé‡ç»Ÿè®¡ï¼ˆé¢„ç•™ï¼‰

### UIå…³é”®å˜åŒ–
- åˆ—è¡¨é¡µ"è¿”ç‚¹"æŒ‰é’®æ ¹æ®è¾¾äººç±»å‹è°ƒç”¨ä¸åŒå¼¹çª—
- å¼¹çª—å†…ä½¿ç”¨Tabåˆ‡æ¢æ›¿ä»£æŒ‰é’®+å¼¹çª—çš„å½¢å¼
- é‡ç”Ÿè¾¾äººå¼¹çª—æ˜¾ç¤º"å•†ä¸šå½’å±"è€Œé"å½’å±æœºæ„"

## ğŸ“‹ æ¦‚è¿° Overview
è¿”ç‚¹ç®¡ç†åŠŸèƒ½éœ€è¦åŒºåˆ†ä¸¤ç§ä¸šåŠ¡åœºæ™¯ï¼šé‡ç”Ÿè¾¾äººï¼ˆç‹¬ç«‹è¾¾äººï¼‰å’Œæœºæ„è¾¾äººã€‚æ¯ç§ç±»å‹çš„è¾¾äººæœ‰ä¸åŒçš„è¿”ç‚¹è§„åˆ™å’Œç®¡ç†æ–¹å¼ã€‚

## ğŸ¯ ä¸šåŠ¡åœºæ™¯ Business Scenarios

### 1. é‡ç”Ÿè¾¾äºº (Wild/Individual Talents)
**å®šä¹‰**: `agencyId = AGENCY_INDIVIDUAL_ID` çš„è¾¾äºº

#### ç‰¹ç‚¹ Characteristics:
- ç‹¬ç«‹è¿è¥ï¼Œæ²¡æœ‰æœºæ„å½’å±
- è¿”ç‚¹ç›´æ¥å½’å±äºè¾¾äººä¸ªäºº
- è¿”ç‚¹ç‡å¯ä»¥å•ç‹¬è®¾ç½®å’Œè°ƒæ•´
- æ”¯æŒé˜¶æ¢¯è·ƒè¿è¿”ç‚¹ï¼ˆé¢„ç•™åŠŸèƒ½ï¼‰
- ä¸å—æœºæ„è¿”ç‚¹æ”¿ç­–å½±å“

#### è¿”ç‚¹è§„åˆ™ Rebate Rules:
- **é»˜è®¤è¿”ç‚¹ç‡**: 0%ï¼ˆæ–°å»ºé‡ç”Ÿè¾¾äººæ—¶è‡ªåŠ¨è®¾ç½®ï¼‰
- **è°ƒæ•´æ–¹å¼**:
  - æ‰‹åŠ¨è°ƒæ•´ï¼šç›´æ¥è®¾ç½®å›ºå®šè¿”ç‚¹ç‡
  - é˜¶æ¢¯è§„åˆ™ï¼šæ ¹æ®åˆä½œé‡è‡ªåŠ¨è·ƒè¿ï¼ˆPhase 2ï¼‰
- **ç”Ÿæ•ˆæ–¹å¼**: ç«‹å³ç”Ÿæ•ˆæˆ–æŒ‡å®šæ—¥æœŸç”Ÿæ•ˆ
- **å†å²è®°å½•**: ä¿å­˜æ¯æ¬¡è°ƒæ•´çš„è®°å½•

#### UI åŠŸèƒ½ UI Features:
- åœ¨è¾¾äººåˆ—è¡¨ä¸­æ˜¾ç¤ºå½“å‰è¿”ç‚¹ç‡
- ç‹¬ç«‹çš„é‡ç”Ÿè¾¾äººè¿”ç‚¹ç®¡ç†å¼¹çª—
- å¼¹çª—å†…å®¹ï¼š
  - å•†ä¸šå½’å±ï¼šæ˜¾ç¤º"é‡ç”Ÿè¾¾äºº"ï¼ˆè¯»å–agencyIdåˆ¤æ–­ï¼‰
  - Tabåˆ‡æ¢å¼è°ƒæ•´ç•Œé¢ï¼š
    - Tab 1: æ‰‹åŠ¨è°ƒæ•´
    - Tab 2: é˜¶æ¢¯è§„åˆ™ï¼ˆé¢„ç•™ï¼‰
  - è°ƒæ•´å†å²è®°å½•
  - å½“å‰é…ç½®å±•ç¤º

### 2. æœºæ„è¾¾äºº (Agency Talents)
**å®šä¹‰**: `agencyId != AGENCY_INDIVIDUAL_ID` çš„è¾¾äºº

#### ç‰¹ç‚¹ Characteristics:
- å±äºç‰¹å®šæœºæ„ç®¡ç†
- æ”¯æŒåŒæ¨¡å¼è¿”ç‚¹ç®¡ç†ï¼š
  - ç‹¬ç«‹æ¨¡å¼ï¼šå¯ä»¥åƒé‡ç”Ÿè¾¾äººä¸€æ ·å•ç‹¬è®¾å®š
  - åŒæ­¥æ¨¡å¼ï¼šéµå¾ªæœºæ„ç»Ÿä¸€æ ‡å‡†
- çµæ´»åˆ‡æ¢ä¸¤ç§æ¨¡å¼

#### è¿”ç‚¹è§„åˆ™ Rebate Rules:
- **é»˜è®¤è®¾ç½®**: æ–°å»ºæ—¶å¯é€‰æ‹©ä½¿ç”¨æœºæ„é»˜è®¤å€¼æˆ–ç‹¬ç«‹è®¾ç½®
- **è°ƒæ•´æ–¹å¼**:
  - æ‰‹åŠ¨è°ƒæ•´ï¼šå•ç‹¬è®¾å®šè¿”ç‚¹ç‡ï¼ˆç‹¬ç«‹æ¨¡å¼ï¼‰
  - æœºæ„åŒæ­¥ï¼šä½¿ç”¨æœºæ„ç»Ÿä¸€è¿”ç‚¹ç‡ï¼ˆåŒæ­¥æ¨¡å¼ï¼‰
  - é˜¶æ¢¯è§„åˆ™ï¼šæŒ‰æœºæ„ç»Ÿè®¡åˆä½œé‡ï¼ˆPhase 2ï¼‰
- **ä¼˜å…ˆçº§**: ç‹¬ç«‹è®¾ç½® > æœºæ„é»˜è®¤è®¾ç½®
- **ç”Ÿæ•ˆæ–¹å¼**: ç«‹å³ç”Ÿæ•ˆæˆ–æŒ‡å®šæ—¥æœŸç”Ÿæ•ˆ

#### UI åŠŸèƒ½ UI Features:
- è¾¾äººè¿”ç‚¹ç®¡ç†å¼¹çª—ï¼š
  - Tab 1: æ‰‹åŠ¨è°ƒæ•´ï¼ˆåŒé‡ç”Ÿè¾¾äººï¼‰
  - Tab 2: æœºæ„åŒæ­¥ï¼ˆé€‰æ‹©ä½¿ç”¨æœºæ„æ ‡å‡†ï¼‰
  - Tab 3: é˜¶æ¢¯è§„åˆ™ï¼ˆé¢„ç•™ï¼ŒæŒ‰æœºæ„ç»Ÿè®¡ï¼‰
  - Tab 4: è°ƒæ•´å†å²
- æ˜¾ç¤ºå½“å‰æ¨¡å¼çŠ¶æ€ï¼ˆç‹¬ç«‹/åŒæ­¥ï¼‰
- æ˜¾ç¤ºæœºæ„é»˜è®¤è¿”ç‚¹ç‡ä½œä¸ºå‚è€ƒ

## ğŸ“Š æ•°æ®ç»“æ„ Data Structure

### talents é›†åˆæ‰©å±•
```typescript
interface Talent {
  // ... ç°æœ‰å­—æ®µ
  agencyId: string;  // AGENCY_INDIVIDUAL_ID è¡¨ç¤ºé‡ç”Ÿè¾¾äºº

  // è¿”ç‚¹ç›¸å…³å­—æ®µï¼ˆä¼˜åŒ–åï¼‰
  rebateMode: 'independent' | 'sync';     // è¿”ç‚¹æ¨¡å¼ï¼ˆé‡ç”Ÿè¾¾äººæ°¸è¿œæ˜¯independentï¼‰
  currentRebate?: {
    rate: number;                        // å½“å‰è¿”ç‚¹ç‡ (0-100)
    effectiveDate: string;               // ç”Ÿæ•ˆæ—¥æœŸ
    source: 'manual' | 'agency_sync';   // æ•°æ®æ¥æº
  };
  lastRebateSyncAt?: Date;              // æœ€ååŒæ­¥æ—¶é—´ï¼ˆä»…æœºæ„è¾¾äººåŒæ­¥æ¨¡å¼ä½¿ç”¨ï¼‰
}
```

### rebate_configs é›†åˆï¼ˆè¿”ç‚¹å†å²è®°å½•ï¼‰
```typescript
interface RebateConfig {
  configId: string;          // é…ç½®ID
  oneId: string;             // è¾¾äººOneID
  platform: Platform;        // å¹³å°
  talentName: string;        // è¾¾äººåç§°ï¼ˆå†—ä½™ï¼Œä¾¿äºæŸ¥è¯¢ï¼‰
  agencyId: string;          // æœºæ„IDï¼ˆAGENCY_INDIVIDUAL_IDè¡¨ç¤ºé‡ç”Ÿè¾¾äººï¼‰

  // è¿”ç‚¹ä¿¡æ¯
  rebateMode: 'independent' | 'sync';  // è¿”ç‚¹æ¨¡å¼
  rebateRate: number;        // è¿”ç‚¹ç‡ (0-100)
  source: 'manual' | 'agency_sync';    // æ•°æ®æ¥æº

  // ç”Ÿæ•ˆä¿¡æ¯
  effectType: 'immediate' | 'scheduled'; // ç”Ÿæ•ˆç±»å‹
  effectiveDate: Date;       // ç”Ÿæ•ˆæ—¥æœŸ
  expiryDate?: Date;         // å¤±æ•ˆæ—¥æœŸï¼ˆå¯é€‰ï¼‰
  status: 'active' | 'pending' | 'expired'; // çŠ¶æ€

  // è°ƒæ•´ä¿¡æ¯
  adjustType: 'manual' | 'agency_sync' | 'mode_switch' | 'step_rule'; // è°ƒæ•´ç±»å‹
  adjustReason?: string;      // è°ƒæ•´åŸå› /å¤‡æ³¨
  previousRate?: number;      // è°ƒæ•´å‰çš„è¿”ç‚¹ç‡

  // å®¡è®¡ä¿¡æ¯
  createdBy: string;         // åˆ›å»ºäºº
  createdAt: Date;           // åˆ›å»ºæ—¶é—´
  updatedBy?: string;        // æ›´æ–°äºº
  updatedAt: Date;           // æ›´æ–°æ—¶é—´
}
```

### agencies é›†åˆæ‰©å±•
```typescript
interface Agency {
  // ... ç°æœ‰å­—æ®µ

  // è¿”ç‚¹ç®¡ç†
  defaultRebateRate: number;      // æœºæ„ç»Ÿä¸€è¿”ç‚¹ç‡ï¼ˆé»˜è®¤0ï¼‰
  rebateUpdateMode: 'auto' | 'manual'; // æ›´æ–°æ¨¡å¼ï¼šè‡ªåŠ¨æ¨é€|æ‰‹åŠ¨åŒæ­¥

  // é˜¶æ¢¯è§„åˆ™ï¼ˆPhase 2ï¼‰
  stepRules?: {
    enabled: boolean;
    rules: Array<{
      minVolume: number;         // æœ€å°åˆä½œé‡
      maxVolume: number;         // æœ€å¤§åˆä½œé‡
      rebateRate: number;         // å¯¹åº”è¿”ç‚¹ç‡
    }>;
    calculationType: 'agency';   // æŒ‰æœºæ„ç»Ÿè®¡
  };

  // ç»Ÿè®¡ä¿¡æ¯
  talentStats?: {
    totalCount: number;           // æ€»è¾¾äººæ•°
    syncModeCount: number;        // åŒæ­¥æ¨¡å¼è¾¾äººæ•°
    independentModeCount: number; // ç‹¬ç«‹æ¨¡å¼è¾¾äººæ•°
  };

  rebateUpdatedAt?: Date;         // è¿”ç‚¹æœ€åæ›´æ–°æ—¶é—´
  rebateUpdatedBy?: string;       // æœ€åæ›´æ–°äºº
}
```

## ğŸ”§ åŠŸèƒ½å®ç° Implementation

### Phase 1: åŸºç¡€åŠŸèƒ½ (v2.4.0 å·²å®Œæˆ âœ…)
1. **é‡ç”Ÿè¾¾äººè¿”ç‚¹ç®¡ç†**
   - [x] æŸ¥çœ‹å½“å‰è¿”ç‚¹é…ç½®
   - [x] æŸ¥çœ‹è°ƒæ•´å†å²
   - [x] å•ä¸ªè¾¾äººè¿”ç‚¹è°ƒæ•´
   - [x] è¿”ç‚¹ç‡éªŒè¯ï¼ˆ0-100%ï¼‰

2. **æœºæ„è¾¾äººè¿”ç‚¹ç®¡ç†**
   - [x] è¯†åˆ«æœºæ„å½’å±
   - [x] æ˜¾ç¤ºæœºæ„é»˜è®¤è¿”ç‚¹
   - [x] å•ä¸ªè¾¾äººè¿”ç‚¹è°ƒæ•´
   - [x] è¿”ç‚¹æ¨¡å¼åˆ‡æ¢ï¼ˆåŒæ­¥/ç‹¬ç«‹ï¼‰
   - [x] æœºæ„è¿”ç‚¹åŒæ­¥åŠŸèƒ½
   - [x] åŠ¨æ€Tabæ˜¾ç¤ºé€»è¾‘

3. **æœºæ„ç®¡ç†å¢å¼º**
   - [x] æœºæ„åˆ—è¡¨æ˜¾ç¤ºè¾¾äººæ•°é‡ç»Ÿè®¡
   - [x] å¹¶è¡ŒAPIè°ƒç”¨ä¼˜åŒ–æ€§èƒ½

### Phase 2: é«˜çº§åŠŸèƒ½ (æœªæ¥æ‰©å±•)
1. **æ‰¹é‡æ“ä½œ**
   - [ ] æŒ‰æœºæ„æ‰¹é‡è°ƒæ•´
   - [ ] æ‰¹é‡å¯¼å…¥/å¯¼å‡º
   - [ ] æ‰¹é‡åŒæ­¥æœºæ„é»˜è®¤å€¼

2. **è§„åˆ™å¼•æ“**
   - [ ] è‡ªåŠ¨è¿”ç‚¹è®¡ç®—
   - [ ] é˜¶æ¢¯è¿”ç‚¹è§„åˆ™
   - [ ] æ¡ä»¶è§¦å‘è°ƒæ•´

3. **å®¡æ‰¹æµç¨‹**
   - [ ] è¿”ç‚¹è°ƒæ•´å®¡æ‰¹
   - [ ] å®¡æ‰¹å†å²è®°å½•
   - [ ] æƒé™ç®¡ç†

## ğŸ¨ UI è®¾è®¡ UI Design

### 1. è¾¾äººåˆ—è¡¨å¢å¼º
```
| è¾¾äººåç§° | å¹³å° | å•†ä¸šå±æ€§ | å½“å‰è¿”ç‚¹ | è¿”ç‚¹å±æ€§ | æ“ä½œ |
|---------|------|---------|---------|---------|------|
| å¼ ä¸‰ | æŠ–éŸ³ | é‡ç”Ÿè¾¾äºº | 10% | ç‹¬ç«‹è®¾ç½® | [è¿”ç‚¹] |
| æå›› | å°çº¢ä¹¦ | XXæœºæ„ | 15% | æœºæ„åŒæ­¥ | [è¿”ç‚¹] |
| ç‹äº” | Bç«™ | YYæœºæ„ | 20% | ç‹¬ç«‹è®¾ç½® | [è¿”ç‚¹] |
```

### 2. é‡ç”Ÿè¾¾äººè¿”ç‚¹ç®¡ç†å¼¹çª—
```
æ ‡é¢˜: è¿”ç‚¹ç®¡ç† - [è¾¾äººåç§°]
å‰¯æ ‡é¢˜: æŸ¥çœ‹å’Œè°ƒæ•´é‡ç”Ÿè¾¾äººçš„è¿”ç‚¹é…ç½®

åŸºç¡€ä¿¡æ¯:
- è¾¾äººåç§°: [åç§°]
- å¹³å°: [å¹³å°]
- å•†ä¸šå½’å±: é‡ç”Ÿè¾¾äºº
- å½“å‰è¿”ç‚¹: X%

Tabæ :
[å½“å‰é…ç½®] [æ‰‹åŠ¨è°ƒæ•´] [é˜¶æ¢¯è§„åˆ™(å¾…å¼€å‘)] [è°ƒæ•´å†å²]

Tabå†…å®¹:
1. å½“å‰é…ç½®ï¼š
   - å½“å‰è¿”ç‚¹ç‡å±•ç¤º
   - ç”Ÿæ•ˆæ—¥æœŸ
   - æœ€è¿‘è°ƒæ•´è®°å½•

2. æ‰‹åŠ¨è°ƒæ•´ï¼š
   - æ–°è¿”ç‚¹ç‡: [è¾“å…¥æ¡†] %
   - ç”Ÿæ•ˆæ–¹å¼: (â—)ç«‹å³ç”Ÿæ•ˆ ( )æŒ‡å®šæ—¥æœŸ
   - ç”Ÿæ•ˆæ—¥æœŸ: [æ—¥æœŸé€‰æ‹©å™¨]
   - å¤±æ•ˆæ—¥æœŸ: [æ—¥æœŸé€‰æ‹©å™¨]ï¼ˆå¯é€‰ï¼‰
   - è°ƒæ•´å¤‡æ³¨: [æ–‡æœ¬æ¡†]
   - [å–æ¶ˆ] [ç¡®è®¤è°ƒæ•´]

3. é˜¶æ¢¯è§„åˆ™ï¼ˆPhase 2ï¼‰ï¼š
   - é¢„ç•™ä½ç½®
   - æ˜¾ç¤º"åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…"

4. è°ƒæ•´å†å²ï¼š
   - æ—¶é—´çº¿å±•ç¤º
   - æ˜¾ç¤ºè°ƒæ•´äººã€æ—¶é—´ã€åŸå› 
   - æ”¯æŒåˆ†é¡µ
```

### 3. æœºæ„è¾¾äººè¿”ç‚¹ç®¡ç†å¼¹çª—
```
æ ‡é¢˜: è¿”ç‚¹ç®¡ç† - [è¾¾äººåç§°]
å‰¯æ ‡é¢˜: æŸ¥çœ‹å’Œè°ƒæ•´æœºæ„è¾¾äººçš„è¿”ç‚¹é…ç½®

åŸºç¡€ä¿¡æ¯:
- è¾¾äººåç§°: [åç§°]
- å¹³å°: [å¹³å°]
- å•†ä¸šå½’å±: [æœºæ„åç§°]
- å½“å‰è¿”ç‚¹: X%
- æœºæ„é»˜è®¤: Y%ï¼ˆå‚è€ƒå€¼ï¼‰

Tabæ ï¼ˆæ ¹æ®æ¨¡å¼åŠ¨æ€æ˜¾ç¤ºï¼‰:
åŒæ­¥æ¨¡å¼: [å½“å‰é…ç½®] [æœºæ„åŒæ­¥] [è°ƒæ•´å†å²]
ç‹¬ç«‹æ¨¡å¼: [å½“å‰é…ç½®] [æ‰‹åŠ¨è°ƒæ•´] [é˜¶æ¢¯è§„åˆ™(å¾…å¼€å‘)] [è°ƒæ•´å†å²]

Tabå†…å®¹:
1. å½“å‰é…ç½®ï¼š
   - å½“å‰è¿”ç‚¹ç‡å±•ç¤º
   - è¿”ç‚¹æ¨¡å¼åˆ‡æ¢å¼€å…³:
     [ ] ç‹¬ç«‹è®¾ç½®  [â—] æœºæ„åŒæ­¥
   - ç”Ÿæ•ˆæ—¥æœŸ
   - å¦‚æœæ˜¯åŒæ­¥æ¨¡å¼ï¼Œæ˜¾ç¤º"æ­£åœ¨ä½¿ç”¨æœºæ„ç»Ÿä¸€è¿”ç‚¹"
   - å¦‚æœæ˜¯ç‹¬ç«‹æ¨¡å¼ï¼Œæ˜¾ç¤º"ä½¿ç”¨ç‹¬ç«‹è¿”ç‚¹è®¾ç½®"

2. æ‰‹åŠ¨è°ƒæ•´ï¼ˆä»…ç‹¬ç«‹æ¨¡å¼æ˜¾ç¤ºï¼‰ï¼š
   - æ–°è¿”ç‚¹ç‡: [è¾“å…¥æ¡†] %
   - ç”Ÿæ•ˆæ–¹å¼: (â—)ç«‹å³ç”Ÿæ•ˆ ( )æŒ‡å®šæ—¥æœŸ
   - ç”Ÿæ•ˆæ—¥æœŸ: [æ—¥æœŸé€‰æ‹©å™¨]
   - å¤±æ•ˆæ—¥æœŸ: [æ—¥æœŸé€‰æ‹©å™¨]ï¼ˆå¯é€‰ï¼‰
   - è°ƒæ•´å¤‡æ³¨: [æ–‡æœ¬æ¡†]
   - [å–æ¶ˆ] [ç¡®è®¤è°ƒæ•´]

3. æœºæ„åŒæ­¥ï¼ˆä»…åŒæ­¥æ¨¡å¼æ˜¾ç¤ºï¼‰ï¼š
   - æ˜¾ç¤ºæœºæ„å½“å‰é»˜è®¤è¿”ç‚¹ç‡: Y%
   - ä¸Šæ¬¡åŒæ­¥æ—¶é—´: YYYY-MM-DD HH:mm
   - [ç«‹å³åŒæ­¥æœ€æ–°æœºæ„è¿”ç‚¹] æŒ‰é’®

4. é˜¶æ¢¯è§„åˆ™ï¼ˆä»…ç‹¬ç«‹æ¨¡å¼æ˜¾ç¤ºï¼ŒPhase 2ï¼‰ï¼š
   - é¢„ç•™ä½ç½®
   - æ˜¾ç¤º"åŠŸèƒ½å¼€å‘ä¸­ï¼ŒæŒ‰ä¸ªäººåˆä½œé‡ç»Ÿè®¡"

5. è°ƒæ•´å†å²ï¼š
   - æ—¶é—´çº¿å±•ç¤º
   - æ ‡è¯†è°ƒæ•´ç±»å‹ï¼ˆæ‰‹åŠ¨/åŒæ­¥/åˆ‡æ¢æ¨¡å¼ï¼‰
   - æ”¯æŒåˆ†é¡µ
```

### 4. æœºæ„è¿”ç‚¹ç®¡ç†å¼¹çª—ï¼ˆæœºæ„ç®¡ç†é¡µï¼‰
```
æ ‡é¢˜: æœºæ„è¿”ç‚¹ç®¡ç† - [æœºæ„åç§°]
å‰¯æ ‡é¢˜: è®¾ç½®æœºæ„ç»Ÿä¸€è¿”ç‚¹æ ‡å‡†

åŸºç¡€ä¿¡æ¯:
- æœºæ„åç§°: [åç§°]
- å…³è”è¾¾äººæ€»æ•°: Xä¸ª
- å½“å‰é»˜è®¤è¿”ç‚¹: Y%
- åŒæ­¥æ¨¡å¼è¾¾äºº: Zä¸ª
- ç‹¬ç«‹æ¨¡å¼è¾¾äºº: Wä¸ª

Tabæ :
[ç»Ÿä¸€è¿”ç‚¹] [é˜¶æ¢¯è§„åˆ™(å¾…å¼€å‘)] [åŒæ­¥å†å²]

Tabå†…å®¹:
1. ç»Ÿä¸€è¿”ç‚¹ï¼š
   - å½“å‰è¿”ç‚¹ç‡: Y%
   - æ–°è¿”ç‚¹ç‡: [è¾“å…¥æ¡†] %
   - ç”Ÿæ•ˆæ–¹å¼: (â—)ç«‹å³ç”Ÿæ•ˆ ( )æŒ‡å®šæ—¥æœŸ
   - ç”Ÿæ•ˆæ—¥æœŸ: [æ—¥æœŸé€‰æ‹©å™¨]
   - è°ƒæ•´å¤‡æ³¨: [æ–‡æœ¬æ¡†]
   - [ä¿å­˜è®¾ç½®] æŒ‰é’®ï¼ˆä»…ä¿å­˜ï¼‰

   åŒæ­¥æ“ä½œåŒºåŸŸï¼ˆç‹¬ç«‹æ¿å—ï¼‰:
   - å°†å½±å“ Z ä¸ªåŒæ­¥æ¨¡å¼çš„è¾¾äºº
   - [åŒæ­¥åˆ°æ‰€æœ‰åŒæ­¥æ¨¡å¼è¾¾äºº] æŒ‰é’®
   - æ³¨ï¼šæ­¤æ“ä½œå°†æ›´æ–°æ‰€æœ‰é€‰æ‹©åŒæ­¥æ¨¡å¼çš„è¾¾äººè¿”ç‚¹

2. é˜¶æ¢¯è§„åˆ™ï¼ˆPhase 2ï¼‰ï¼š
   - é¢„ç•™ä½ç½®
   - åŸºäºæœºæ„æ•´ä½“åˆä½œé‡è®¾ç½®é˜¶æ¢¯è¿”ç‚¹

3. åŒæ­¥å†å²ï¼š
   - æ˜¾ç¤ºæœºæ„è¿”ç‚¹è°ƒæ•´å†å²
   - æ˜¾ç¤ºæ¯æ¬¡åŒæ­¥æ“ä½œå½±å“çš„è¾¾äººæ•°é‡
   - æ˜¾ç¤ºæ“ä½œäººå’Œæ—¶é—´
```

## ğŸ”„ ä¸šåŠ¡æµç¨‹ Business Flow

### é‡ç”Ÿè¾¾äººè¿”ç‚¹è°ƒæ•´æµç¨‹
```mermaid
graph LR
    A[é€‰æ‹©é‡ç”Ÿè¾¾äºº] --> B[æ‰“å¼€è¿”ç‚¹ç®¡ç†å¼¹çª—]
    B --> C[æ˜¾ç¤ºå•†ä¸šå½’å±:é‡ç”Ÿè¾¾äºº]
    C --> D{é€‰æ‹©è°ƒæ•´æ–¹å¼}
    D -->|æ‰‹åŠ¨è°ƒæ•´| E[åˆ‡æ¢åˆ°æ‰‹åŠ¨è°ƒæ•´Tab]
    D -->|é˜¶æ¢¯è§„åˆ™| F[åˆ‡æ¢åˆ°é˜¶æ¢¯è§„åˆ™Tab]
    E --> G[è¾“å…¥æ–°è¿”ç‚¹ç‡]
    F --> H[é…ç½®é˜¶æ¢¯è§„åˆ™-é¢„ç•™]
    G --> I[é€‰æ‹©ç”Ÿæ•ˆæ–¹å¼]
    I --> J[æäº¤è°ƒæ•´]
    J --> K[æ›´æ–°æ•°æ®åº“]
    K --> L[è®°å½•å†å²]
```

### æœºæ„è¾¾äººè¿”ç‚¹è°ƒæ•´æµç¨‹
```mermaid
graph LR
    A[é€‰æ‹©æœºæ„è¾¾äºº] --> B[æ‰“å¼€è¿”ç‚¹ç®¡ç†]
    B --> C[æŸ¥çœ‹å½“å‰é…ç½®]
    C --> D{æ˜¯å¦ä½¿ç”¨æœºæ„é»˜è®¤}
    D -->|æ˜¯| E[æ˜¾ç¤ºæœºæ„é»˜è®¤å€¼]
    D -->|å¦| F[æ˜¾ç¤ºä¸ªäººè®¾ç½®å€¼]
    E --> G[ç‚¹å‡»è°ƒæ•´è¿”ç‚¹]
    F --> G
    G --> H[é€‰æ‹©è°ƒæ•´æ–¹å¼]
    H -->|è¦†ç›–æœºæ„é»˜è®¤| I[è¾“å…¥æ–°è¿”ç‚¹ç‡]
    H -->|æ¢å¤æœºæ„é»˜è®¤| J[ç¡®è®¤æ¢å¤]
    I --> K[æäº¤è°ƒæ•´]
    J --> K
    K --> L[æ›´æ–°æ•°æ®åº“]
    L --> M[è®°å½•å†å²]
```

## ğŸ’¡ å®ç°ç¤ºä¾‹ Implementation Examples

### åˆ¤æ–­è¾¾äººç±»å‹
```typescript
// utils/rebate.ts
import { AGENCY_INDIVIDUAL_ID } from '../types/agency';

export function isWildTalent(talent: Talent): boolean {
  return talent.agencyId === AGENCY_INDIVIDUAL_ID;
}

export function canSwitchRebateMode(talent: Talent): boolean {
  return !isWildTalent(talent);  // åªæœ‰æœºæ„è¾¾äººå¯ä»¥åˆ‡æ¢æ¨¡å¼
}

export function shouldSyncWithAgency(talent: Talent): boolean {
  return !isWildTalent(talent) && talent.rebateMode === 'sync';
}
```

### æ–°å»ºè¾¾äººæ—¶çš„é»˜è®¤å€¼è®¾ç½®
```typescript
// äº‘å‡½æ•°: createTalent
export async function createTalent(params: CreateTalentParams) {
  const { agencyId, ...otherParams } = params;

  const isWild = agencyId === AGENCY_INDIVIDUAL_ID;

  // è·å–æœºæ„é»˜è®¤è¿”ç‚¹ï¼ˆå¦‚æœæ˜¯æœºæ„è¾¾äººï¼‰
  let defaultRate = 0;
  let source: 'manual' | 'agency_sync' = 'manual';

  if (!isWild) {
    const agency = await db.collection('agencies').doc(agencyId).get();
    defaultRate = agency.defaultRebateRate || 0;
    source = 'agency_sync';
  }

  const newTalent = {
    ...otherParams,
    agencyId,
    rebateMode: isWild ? 'independent' : 'sync',  // é‡ç”Ÿè¾¾äººæ°¸è¿œindependent
    currentRebate: {
      rate: defaultRate,
      effectiveDate: new Date().toISOString(),
      source: isWild ? 'manual' : source
    },
    createdAt: new Date()
  };

  return await db.collection('talents').add(newTalent);
}
```

### è¿”ç‚¹è°ƒæ•´é€»è¾‘
```typescript
// äº‘å‡½æ•°: adjustTalentRebate
export async function adjustTalentRebate(params: {
  oneId: string;
  platform: Platform;
  newRate: number;
  reason?: string;
}) {
  const { oneId, platform, newRate, reason } = params;

  // è·å–è¾¾äººä¿¡æ¯
  const talent = await getTalent(oneId, platform);
  if (!talent) throw new Error('è¾¾äººä¸å­˜åœ¨');

  // é‡ç”Ÿè¾¾äººæˆ–ç‹¬ç«‹æ¨¡å¼çš„æœºæ„è¾¾äººæ‰èƒ½æ‰‹åŠ¨è°ƒæ•´
  if (talent.rebateMode === 'sync' && talent.agencyId !== AGENCY_INDIVIDUAL_ID) {
    throw new Error('åŒæ­¥æ¨¡å¼ä¸‹ä¸èƒ½æ‰‹åŠ¨è°ƒæ•´è¿”ç‚¹ï¼Œè¯·å…ˆåˆ‡æ¢åˆ°ç‹¬ç«‹æ¨¡å¼');
  }

  // ä¿å­˜å†å²è®°å½•
  await db.collection('rebate_configs').add({
    configId: generateId(),
    oneId,
    platform,
    talentName: talent.name,
    agencyId: talent.agencyId,
    rebateMode: talent.rebateMode,
    rebateRate: newRate,
    source: 'manual',
    effectType: 'immediate',
    effectiveDate: new Date(),
    status: 'active',
    adjustType: 'manual',
    adjustReason: reason,
    previousRate: talent.currentRebate?.rate,
    createdBy: getCurrentUser(),
    createdAt: new Date()
  });

  // æ›´æ–°è¾¾äººå½“å‰è¿”ç‚¹
  await db.collection('talents')
    .where('oneId', '==', oneId)
    .where('platform', '==', platform)
    .update({
      currentRebate: {
        rate: newRate,
        effectiveDate: new Date().toISOString(),
        source: 'manual'
      },
      updatedAt: new Date()
    });

  return { success: true };
}
```

### æœºæ„è¾¾äººæ¨¡å¼åˆ‡æ¢
```typescript
// äº‘å‡½æ•°: switchTalentRebateMode
export async function switchTalentRebateMode(params: {
  oneId: string;
  platform: Platform;
  newMode: 'sync' | 'independent';
}) {
  const { oneId, platform, newMode } = params;

  const talent = await getTalent(oneId, platform);
  if (!talent) throw new Error('è¾¾äººä¸å­˜åœ¨');

  // é‡ç”Ÿè¾¾äººä¸èƒ½åˆ‡æ¢æ¨¡å¼
  if (talent.agencyId === AGENCY_INDIVIDUAL_ID) {
    throw new Error('é‡ç”Ÿè¾¾äººä¸æ”¯æŒåˆ‡æ¢è¿”ç‚¹æ¨¡å¼');
  }

  // å¦‚æœåˆ‡æ¢åˆ°åŒæ­¥æ¨¡å¼ï¼Œéœ€è¦æ›´æ–°è¿”ç‚¹ç‡
  let updateData: any = {
    rebateMode: newMode,
    updatedAt: new Date()
  };

  if (newMode === 'sync') {
    // è·å–æœºæ„å½“å‰è¿”ç‚¹ç‡
    const agency = await db.collection('agencies').doc(talent.agencyId).get();
    const agencyRate = agency.defaultRebateRate || 0;

    updateData.currentRebate = {
      rate: agencyRate,
      effectiveDate: new Date().toISOString(),
      source: 'agency_sync'
    };
    updateData.lastRebateSyncAt = new Date();
  }

  // è®°å½•æ¨¡å¼åˆ‡æ¢å†å²
  await db.collection('rebate_configs').add({
    configId: generateId(),
    oneId,
    platform,
    talentName: talent.name,
    agencyId: talent.agencyId,
    rebateMode: newMode,
    rebateRate: newMode === 'sync' ? updateData.currentRebate.rate : talent.currentRebate.rate,
    source: newMode === 'sync' ? 'agency_sync' : 'manual',
    adjustType: 'mode_switch',
    adjustReason: `åˆ‡æ¢åˆ°${newMode === 'sync' ? 'åŒæ­¥' : 'ç‹¬ç«‹'}æ¨¡å¼`,
    previousRate: talent.currentRebate?.rate,
    createdBy: getCurrentUser(),
    createdAt: new Date()
  });

  // æ›´æ–°è¾¾äººä¿¡æ¯
  await db.collection('talents')
    .where('oneId', '==', oneId)
    .where('platform', '==', platform)
    .update(updateData);

  return { success: true };
}
```

## ğŸ“ å¼€å‘ä»»åŠ¡ Development Tasks

### ç«‹å³å¼€å§‹çš„ä»»åŠ¡
1. **åç«¯APIå¼€å‘**
   - [ ] åˆ›å»ºè¿”ç‚¹è°ƒæ•´API endpoint
   - [ ] å®ç°é‡ç”Ÿè¾¾äººè¿”ç‚¹é€»è¾‘ï¼ˆé»˜è®¤0%ï¼‰
   - [ ] å®ç°æœºæ„è¾¾äººè¿”ç‚¹é€»è¾‘
   - [ ] æ·»åŠ æ•°æ®éªŒè¯

2. **å‰ç«¯ç»„ä»¶å¼€å‘**
   - [ ] æ”¹é€ RebateManagementModalæ”¯æŒä¸¤ç§è¾¾äººç±»å‹
   - [ ] å®ç°Tabåˆ‡æ¢å¼è°ƒæ•´ç•Œé¢
   - [ ] åˆ›å»ºæ‰‹åŠ¨è°ƒæ•´Tabç»„ä»¶
   - [ ] é¢„ç•™é˜¶æ¢¯è§„åˆ™Tabä½ç½®
   - [ ] åœ¨è¾¾äººåˆ—è¡¨"è¿”ç‚¹"æŒ‰é’®è°ƒç”¨ä¸åŒå¼¹çª—
   - [ ] æ˜¾ç¤º"å•†ä¸šå½’å±"è€Œé"å½’å±æœºæ„"

3. **ä¸šåŠ¡é€»è¾‘å®ç°**
   - [ ] é‡ç”Ÿè¾¾äººç‹¬ç«‹è¿”ç‚¹è®¾ç½®ï¼ˆé»˜è®¤0%ï¼‰
   - [ ] é‡ç”Ÿè¾¾äººè¯†åˆ«é€»è¾‘ï¼ˆagencyId = AGENCY_INDIVIDUAL_IDï¼‰
   - [ ] æœºæ„è¾¾äººé»˜è®¤å€¼ç»§æ‰¿
   - [ ] è¿”ç‚¹ç‡éªŒè¯ï¼ˆ0-100%ï¼‰
   - [ ] å†å²è®°å½•ä¿å­˜

## ğŸš€ å®æ–½æ­¥éª¤ Implementation Steps

### Step 1: é‡ç”Ÿè¾¾äººåŸºç¡€åŠŸèƒ½
1. æ”¹é€ RebateManagementModalè¯†åˆ«è¾¾äººç±»å‹
2. æ ¹æ®agencyIdåˆ¤æ–­æ˜¾ç¤ºä¸åŒUI
3. å®ç°Tabåˆ‡æ¢ç•Œé¢ï¼ˆå½“å‰é…ç½®ã€æ‰‹åŠ¨è°ƒæ•´ã€é˜¶æ¢¯è§„åˆ™ã€è°ƒæ•´å†å²ï¼‰
4. é‡ç”Ÿè¾¾äººæ–°å»ºæ—¶é»˜è®¤è¿”ç‚¹ç‡0%

### Step 2: é‡ç”Ÿè¾¾äººæ‰‹åŠ¨è°ƒæ•´
1. å®ç°æ‰‹åŠ¨è°ƒæ•´TabåŠŸèƒ½
2. å¼€å‘è¿”ç‚¹ç‡è¾“å…¥éªŒè¯ï¼ˆ0-100%ï¼‰
3. å®ç°ç«‹å³ç”Ÿæ•ˆ/æŒ‡å®šæ—¥æœŸç”Ÿæ•ˆé€»è¾‘
4. ä¿å­˜è°ƒæ•´å†å²è®°å½•

### Step 3: æœºæ„è¾¾äººåŠŸèƒ½
1. å®ç°æœºæ„é»˜è®¤å€¼è¯»å–
2. å¼€å‘æœºæ„åŒæ­¥Tab
3. å®ç°è¦†ç›–/æ¢å¤é»˜è®¤å€¼åŠŸèƒ½
4. æµ‹è¯•æœºæ„è¾¾äººè¿”ç‚¹æµç¨‹

### Step 4: é˜¶æ¢¯è§„åˆ™é¢„ç•™
1. åœ¨é‡ç”Ÿè¾¾äººå¼¹çª—é¢„ç•™é˜¶æ¢¯è§„åˆ™Tab
2. æ˜¾ç¤º"åŠŸèƒ½å¼€å‘ä¸­"æç¤º
3. ä¸ºåç»­åˆä½œé‡è·ƒè¿åšå‡†å¤‡

### Step 5: é›†æˆæµ‹è¯•
1. ç«¯åˆ°ç«¯æµ‹è¯•ä¸¤ç§è¾¾äººç±»å‹
2. éªŒè¯é»˜è®¤å€¼è®¾ç½®
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

## ğŸ” æƒé™ç³»ç»Ÿé¢„ç•™ Permission System Preparation

### é¢„ç•™æƒé™ç‚¹
1. **è¿”ç‚¹æŸ¥çœ‹æƒé™** (rebate.view)
2. **è¿”ç‚¹è°ƒæ•´æƒé™** (rebate.edit)
3. **æœºæ„è¿”ç‚¹ç®¡ç†æƒé™** (agency.rebate.manage)
4. **è¿”ç‚¹åŒæ­¥æƒé™** (rebate.sync)
5. **æ¨¡å¼åˆ‡æ¢æƒé™** (rebate.mode.switch)

### æƒé™æ§åˆ¶é¢„ç•™ä½ç½®
```typescript
// äº‘å‡½æ•°ä¸­é¢„ç•™æƒé™æ£€æŸ¥
async function adjustRebate(params) {
  // TODO: æƒé™æ£€æŸ¥
  // if (!hasPermission(user, 'rebate.edit')) {
  //   throw new Error('æ— æƒé™è°ƒæ•´è¿”ç‚¹');
  // }

  // ä¸šåŠ¡é€»è¾‘...
}
```

### UIå±‚æƒé™æ§åˆ¶
- æŒ‰é’®æ˜¾ç¤º/éšè—åŸºäºæƒé™
- Tabé¡µé¢è®¿é—®æ§åˆ¶
- æ“ä½œç¡®è®¤äºŒæ¬¡éªŒè¯

## âœ… å·²æ˜ç¡®çš„ä¸šåŠ¡è§„åˆ™ Confirmed Business Rules

åŸºäºä¼˜åŒ–åçš„è®¾è®¡ï¼Œä»¥ä¸‹è§„åˆ™å·²æ˜ç¡®ï¼š

1. **æ•°æ®æ¨¡å‹ç®€åŒ–**:
   - ç§»é™¤ `rebateAttribute` å­—æ®µï¼ˆé€šè¿‡ `agencyId` åˆ¤æ–­å³å¯ï¼‰
   - æ‰€æœ‰è¾¾äººéƒ½æœ‰ `rebateMode` å­—æ®µï¼ˆé‡ç”Ÿè¾¾äººæ°¸è¿œæ˜¯ `independent`ï¼‰
   - æ‰€æœ‰è¾¾äººçš„ `currentRebate` éƒ½åŒ…å« `source` å­—æ®µ

2. **é»˜è®¤å€¼è®¾ç½®**:
   - é‡ç”Ÿè¾¾äººï¼šæ–°å»ºæ—¶ `rebateMode='independent'`, `rate=0`, `source='manual'`
   - æœºæ„è¾¾äººï¼šæ–°å»ºæ—¶ `rebateMode='sync'`, ç»§æ‰¿æœºæ„è¿”ç‚¹ç‡, `source='agency_sync'`

3. **æ¨¡å¼åˆ‡æ¢è§„åˆ™**:
   - é‡ç”Ÿè¾¾äººï¼šä¸èƒ½åˆ‡æ¢æ¨¡å¼ï¼Œæ°¸è¿œæ˜¯ `independent`
   - æœºæ„è¾¾äººï¼šå¯ä»¥åœ¨ `sync` å’Œ `independent` ä¹‹é—´åˆ‡æ¢
   - åˆ‡æ¢åˆ°ç‹¬ç«‹æ¨¡å¼åï¼Œ`source` å˜ä¸º `manual`

4. **è¿”ç‚¹å±æ€§æ˜¾ç¤ºé€»è¾‘**:
   ```typescript
   function getRebateAttribute(talent: Talent): string {
     if (talent.agencyId === AGENCY_INDIVIDUAL_ID) {
       return 'ç‹¬ç«‹è®¾ç½®';  // é‡ç”Ÿè¾¾äºº
     }
     return talent.rebateMode === 'sync' ? 'æœºæ„åŒæ­¥' : 'ç‹¬ç«‹è®¾ç½®';
   }
   ```

5. **æœºæ„åŒæ­¥æœºåˆ¶**:
   - æ‰‹åŠ¨è§¦å‘ï¼šé€šè¿‡æŒ‰é’®ä¸»åŠ¨åŒæ­¥åˆ°æ‰€æœ‰ `rebateMode='sync'` çš„è¾¾äºº
   - ä¿å­˜å’ŒåŒæ­¥åˆ†ç¦»ï¼šå…ˆä¿å­˜æœºæ„è¿”ç‚¹ï¼Œå†é€‰æ‹©æ˜¯å¦åŒæ­¥
   - åŒæ­¥æ—¶æ›´æ–° `source='agency_sync'` å’Œ `lastRebateSyncAt`

6. **Tabæ˜¾ç¤ºé€»è¾‘**:
   - é‡ç”Ÿè¾¾äººï¼š[å½“å‰é…ç½®] [æ‰‹åŠ¨è°ƒæ•´] [é˜¶æ¢¯è§„åˆ™(é¢„ç•™)] [è°ƒæ•´å†å²]
   - æœºæ„è¾¾äºº(sync)ï¼š[å½“å‰é…ç½®] [æœºæ„åŒæ­¥] [è°ƒæ•´å†å²]
   - æœºæ„è¾¾äºº(independent)ï¼š[å½“å‰é…ç½®] [æ‰‹åŠ¨è°ƒæ•´] [é˜¶æ¢¯è§„åˆ™(é¢„ç•™)] [è°ƒæ•´å†å²]

7. **é˜¶æ¢¯è§„åˆ™é¢„ç•™**:
   - é‡ç”Ÿè¾¾äºº/ç‹¬ç«‹æ¨¡å¼ï¼šæŒ‰ä¸ªäººåˆä½œé‡ç»Ÿè®¡
   - åŒæ­¥æ¨¡å¼ï¼šæŒ‰æœºæ„æ€»åˆä½œé‡ç»Ÿè®¡

## â“ FAQ å¸¸è§é—®é¢˜è§£ç­”

### Q1: ä¸ºä»€ä¹ˆä¸éœ€è¦ rebateAttribute å­—æ®µï¼Ÿ
**A**: å› ä¸ºå¯ä»¥é€šè¿‡ `agencyId === AGENCY_INDIVIDUAL_ID` ç›´æ¥åˆ¤æ–­æ˜¯å¦ä¸ºé‡ç”Ÿè¾¾äººï¼Œé¿å…æ•°æ®å†—ä½™ã€‚

### Q2: é‡ç”Ÿè¾¾äººçš„ rebateMode ä¸ºä»€ä¹ˆä¹Ÿæ˜¯ independentï¼Ÿ
**A**: ç»Ÿä¸€æ•°æ®ç»“æ„ï¼Œå‡å°‘ null æ£€æŸ¥ã€‚é‡ç”Ÿè¾¾äººçš„ rebateMode æ°¸è¿œæ˜¯ `independent`ï¼Œä¸èƒ½ä¿®æ”¹ã€‚

### Q3: source å­—æ®µçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
**A**: æ ‡è¯†è¿”ç‚¹ç‡çš„æ•°æ®æ¥æºï¼š
- `manual`: æ‰‹åŠ¨è®¾ç½®ï¼ˆé‡ç”Ÿè¾¾äººæˆ–ç‹¬ç«‹æ¨¡å¼ï¼‰
- `agency_sync`: æ¥è‡ªæœºæ„åŒæ­¥ï¼ˆä»…åŒæ­¥æ¨¡å¼ï¼‰

### Q4: æœºæ„è¾¾äººåˆ‡æ¢åˆ°ç‹¬ç«‹æ¨¡å¼åè¿˜èƒ½æ”¹å›åŒæ­¥å—ï¼Ÿ
**A**: å¯ä»¥ã€‚æœºæ„è¾¾äººå¯ä»¥åœ¨ä¸¤ç§æ¨¡å¼é—´è‡ªç”±åˆ‡æ¢ã€‚åˆ‡æ¢åˆ°åŒæ­¥æ¨¡å¼æ—¶ä¼šè‡ªåŠ¨è·å–æœ€æ–°çš„æœºæ„è¿”ç‚¹ç‡ã€‚

### Q5: åŒæ­¥æ¨¡å¼ä¸‹èƒ½æ‰‹åŠ¨è°ƒæ•´è¿”ç‚¹å—ï¼Ÿ
**A**: ä¸èƒ½ã€‚åŒæ­¥æ¨¡å¼ä¸‹è¿”ç‚¹ç‡åªèƒ½é€šè¿‡æœºæ„ç»Ÿä¸€æ›´æ–°ã€‚å¦‚éœ€æ‰‹åŠ¨è°ƒæ•´ï¼Œéœ€å…ˆåˆ‡æ¢åˆ°ç‹¬ç«‹æ¨¡å¼ã€‚

### Q6: æ‰¹é‡åŒæ­¥å¦‚ä½•è§¦å‘ï¼Ÿ
**A**: åœ¨æœºæ„ç®¡ç†é¡µé¢ï¼Œå…ˆä¿å­˜æ–°çš„æœºæ„è¿”ç‚¹ç‡ï¼Œç„¶åç‚¹å‡»"åŒæ­¥åˆ°æ‰€æœ‰åŒæ­¥æ¨¡å¼è¾¾äºº"æŒ‰é’®ã€‚

### Q7: è¿”ç‚¹å†å²è®°å½•ä¿å­˜åœ¨å“ªé‡Œï¼Ÿ
**A**: ä¿å­˜åœ¨ `rebate_configs` é›†åˆä¸­ï¼Œæ¯æ¬¡è°ƒæ•´éƒ½ä¼šåˆ›å»ºæ–°è®°å½•ï¼ŒåŒ…æ‹¬è°ƒæ•´ç±»å‹ã€åŸå› ã€æ“ä½œäººç­‰ä¿¡æ¯ã€‚

### Q8: å¦‚ä½•è¯†åˆ«è¾¾äººçš„è¿”ç‚¹å±æ€§åœ¨UIä¸Šæ˜¾ç¤ºï¼Ÿ
**A**: ä½¿ç”¨ä»¥ä¸‹é€»è¾‘ï¼š
```typescript
if (agencyId === AGENCY_INDIVIDUAL_ID) return 'ç‹¬ç«‹è®¾ç½®';
return rebateMode === 'sync' ? 'æœºæ„åŒæ­¥' : 'ç‹¬ç«‹è®¾ç½®';
```

## âš ï¸ æ³¨æ„äº‹é¡¹ Important Notes

1. **é‡ç”Ÿè¾¾äººç‰¹æ®Šå¤„ç†**:
   - æ–°å»ºæ—¶è‡ªåŠ¨è®¾ç½®è¿”ç‚¹ç‡ä¸º0%
   - å¼¹çª—æ˜¾ç¤º"å•†ä¸šå½’å±ï¼šé‡ç”Ÿè¾¾äºº"
   - ä¸æ˜¾ç¤ºæœºæ„ç›¸å…³ä¿¡æ¯
   - é¢„ç•™é˜¶æ¢¯è§„åˆ™Tabä½ç½®

2. **æ•°æ®ä¸€è‡´æ€§**:
   - ç¡®ä¿è¿”ç‚¹è°ƒæ•´çš„åŸå­æ€§æ“ä½œ
   - agencyIdå­—æ®µç»Ÿä¸€åˆ¤æ–­é€»è¾‘

3. **UIå·®å¼‚åŒ–**:
   - é‡ç”Ÿè¾¾äººå’Œæœºæ„è¾¾äººä½¿ç”¨ä¸åŒçš„Tabç»“æ„
   - é‡ç”Ÿè¾¾äººå¼ºè°ƒç‹¬ç«‹ç®¡ç†
   - æœºæ„è¾¾äººå¼ºè°ƒä¸æœºæ„çš„å…³è”

4. **æƒé™æ§åˆ¶**: éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è°ƒæ•´è¿”ç‚¹
5. **å®¡è®¡æ—¥å¿—**: æ‰€æœ‰è°ƒæ•´å¿…é¡»è®°å½•æ“ä½œäººå’Œæ—¶é—´
6. **è¾¹ç•Œæ¡ä»¶**: å¤„ç†è¿”ç‚¹ç‡ä¸º0%å’Œ100%çš„æƒ…å†µ
7. **å¹¶å‘æ§åˆ¶**: é˜²æ­¢åŒæ—¶è°ƒæ•´å¯¼è‡´çš„æ•°æ®å†²çª

---
ğŸ¤– Generated with Claude Code