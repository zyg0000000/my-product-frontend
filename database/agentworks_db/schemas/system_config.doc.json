{
    "collection": "system_config",
    "description": "系统配置集合 - 存储平台配置、标签配置等全局系统配置",
    "database": "agentworks_db",
    "version": "1.1",
    "lastUpdated": "2025-12-22",
    "author": "产品团队",
    "fields": {
        "_id": {
            "type": "ObjectId",
            "description": "MongoDB 文档 ID",
            "required": true,
            "auto": true
        },
        "configType": {
            "type": "String",
            "description": "配置类型",
            "required": true,
            "enum": ["platform", "talent_tags", "project", "company_rebate_import"],
            "comment": "platform=平台配置, talent_tags=达人标签配置, project=项目管理配置, company_rebate_import=公司返点导入配置"
        }
    },
    "configTypes": {
        "platform": {
            "description": "平台配置 - 定义各平台的业务配置",
            "fields": {
                "platform": {
                    "type": "String",
                    "description": "平台标识",
                    "required": true,
                    "enum": ["douyin", "xiaohongshu", "bilibili", "kuaishou"],
                    "example": "douyin"
                },
                "name": {
                    "type": "String",
                    "description": "平台显示名称",
                    "required": true,
                    "example": "抖音"
                },
                "enabled": {
                    "type": "Boolean",
                    "description": "是否启用",
                    "required": true,
                    "default": false
                },
                "color": {
                    "type": "String",
                    "description": "平台主题色",
                    "example": "blue"
                },
                "order": {
                    "type": "Integer",
                    "description": "排序序号",
                    "example": 1
                },
                "accountId": {
                    "type": "Object",
                    "description": "账号ID配置",
                    "properties": {
                        "label": {
                            "type": "String",
                            "description": "账号ID标签",
                            "example": "星图ID"
                        },
                        "placeholder": {
                            "type": "String",
                            "description": "输入提示",
                            "example": "请输入星图ID"
                        },
                        "helpText": {
                            "type": "String",
                            "description": "帮助文本",
                            "example": "星图ID是抖音平台的唯一标识，可在星图后台查看"
                        }
                    }
                },
                "priceTypes": {
                    "type": "Array",
                    "description": "价格类型配置",
                    "itemType": "Object",
                    "itemSchema": {
                        "key": {
                            "type": "String",
                            "description": "价格类型key",
                            "example": "video_60plus"
                        },
                        "label": {
                            "type": "String",
                            "description": "显示名称",
                            "example": "60s+"
                        },
                        "required": {
                            "type": "Boolean",
                            "description": "是否必填",
                            "default": true
                        },
                        "bgColor": {
                            "type": "String",
                            "description": "背景色",
                            "example": "#dbeafe"
                        },
                        "textColor": {
                            "type": "String",
                            "description": "文字色",
                            "example": "#1e40af"
                        },
                        "order": {
                            "type": "Integer",
                            "description": "排序"
                        }
                    }
                },
                "specificFields": {
                    "type": "Object",
                    "description": "平台特有字段配置",
                    "comment": "定义该平台特有的字段"
                },
                "business": {
                    "type": "Object",
                    "description": "业务配置",
                    "properties": {
                        "fee": {
                            "type": "Double",
                            "description": "平台费率",
                            "example": 0.05
                        },
                        "defaultRebate": {
                            "type": "Double",
                            "description": "默认返点率",
                            "example": 15
                        },
                        "minRebate": {
                            "type": "Double",
                            "description": "最小返点率",
                            "default": 0
                        },
                        "maxRebate": {
                            "type": "Double",
                            "description": "最大返点率",
                            "default": 100
                        }
                    }
                },
                "features": {
                    "type": "Object",
                    "description": "功能开关",
                    "properties": {
                        "priceManagement": {
                            "type": "Boolean",
                            "description": "价格管理",
                            "default": false
                        },
                        "performanceTracking": {
                            "type": "Boolean",
                            "description": "表现追踪",
                            "default": false
                        },
                        "rebateManagement": {
                            "type": "Boolean",
                            "description": "返点管理",
                            "default": false
                        },
                        "dataImport": {
                            "type": "Boolean",
                            "description": "数据导入",
                            "default": false
                        }
                    }
                },
                "links": {
                    "type": "Array",
                    "description": "相关链接",
                    "itemType": "String",
                    "default": []
                },
                "dbVersion": {
                    "type": "String",
                    "description": "数据库版本标记",
                    "example": "v2"
                },
                "version": {
                    "type": "Integer",
                    "description": "配置版本号",
                    "example": 11
                },
                "createdBy": {
                    "type": "String",
                    "description": "创建人"
                },
                "createdAt": {
                    "type": "Date",
                    "description": "创建时间"
                },
                "updatedAt": {
                    "type": "Date",
                    "description": "更新时间"
                }
            }
        },
        "talent_tags": {
            "description": "达人标签配置 - 定义客户达人池的标签选项",
            "fields": {
                "importanceLevels": {
                    "type": "Array",
                    "description": "重要程度配置（单选）",
                    "itemType": "Object",
                    "itemSchema": {
                        "key": {
                            "type": "String",
                            "description": "重要程度key",
                            "enum": ["core", "key", "normal", "backup", "observe"],
                            "example": "core"
                        },
                        "name": {
                            "type": "String",
                            "description": "显示名称",
                            "example": "核心"
                        },
                        "bgColor": {
                            "type": "String",
                            "description": "背景色",
                            "example": "#fee2e2"
                        },
                        "textColor": {
                            "type": "String",
                            "description": "文字色",
                            "example": "#dc2626"
                        },
                        "sortOrder": {
                            "type": "Integer",
                            "description": "排序序号"
                        },
                        "description": {
                            "type": "String",
                            "description": "说明",
                            "example": "必须维护的核心达人，不可替代"
                        }
                    }
                },
                "businessTags": {
                    "type": "Array",
                    "description": "业务标签配置（多选）",
                    "itemType": "Object",
                    "itemSchema": {
                        "key": {
                            "type": "String",
                            "description": "业务标签key",
                            "example": "long_term"
                        },
                        "name": {
                            "type": "String",
                            "description": "显示名称",
                            "example": "长期合作"
                        },
                        "bgColor": {
                            "type": "String",
                            "description": "背景色",
                            "example": "#dcfce7"
                        },
                        "textColor": {
                            "type": "String",
                            "description": "文字色",
                            "example": "#16a34a"
                        },
                        "sortOrder": {
                            "type": "Integer",
                            "description": "排序序号"
                        }
                    }
                },
                "version": {
                    "type": "Integer",
                    "description": "配置版本号",
                    "example": 2
                },
                "createdBy": {
                    "type": "String",
                    "description": "创建人"
                },
                "createdAt": {
                    "type": "Date",
                    "description": "创建时间"
                },
                "updatedBy": {
                    "type": "String",
                    "description": "更新人"
                },
                "updatedAt": {
                    "type": "Date",
                    "description": "更新时间"
                }
            }
        },
        "project": {
            "description": "项目管理配置 - 定义项目状态和交付KPI指标",
            "fields": {
                "statuses": {
                    "type": "Array",
                    "description": "项目状态配置",
                    "itemType": "Object",
                    "itemSchema": {
                        "key": {
                            "type": "String",
                            "description": "状态key",
                            "enum": ["executing", "pending_settlement", "settled", "closed"],
                            "example": "executing"
                        },
                        "name": {
                            "type": "String",
                            "description": "显示名称",
                            "example": "执行中"
                        },
                        "color": {
                            "type": "String",
                            "description": "Ant Design 颜色预设",
                            "example": "processing"
                        },
                        "isDefault": {
                            "type": "Boolean",
                            "description": "是否为创建项目时的默认状态",
                            "default": false
                        },
                        "sortOrder": {
                            "type": "Integer",
                            "description": "排序序号"
                        }
                    }
                },
                "availableKPIs": {
                    "type": "Array",
                    "description": "可用的交付KPI指标定义",
                    "itemType": "Object",
                    "itemSchema": {
                        "key": {
                            "type": "String",
                            "description": "指标key",
                            "example": "cpm"
                        },
                        "name": {
                            "type": "String",
                            "description": "指标显示名称",
                            "example": "CPM"
                        },
                        "unit": {
                            "type": "String",
                            "description": "单位",
                            "example": "元"
                        },
                        "description": {
                            "type": "String",
                            "description": "指标说明",
                            "example": "千次播放成本"
                        },
                        "targetDirection": {
                            "type": "String",
                            "description": "目标优化方向",
                            "enum": ["lower_better", "higher_better"],
                            "example": "lower_better"
                        },
                        "formula": {
                            "type": "Object",
                            "description": "计算公式（用于自动计算）",
                            "properties": {
                                "numerator": {
                                    "type": "String",
                                    "description": "分子字段",
                                    "example": "cost"
                                },
                                "denominator": {
                                    "type": "String",
                                    "description": "分母字段",
                                    "example": "plays"
                                },
                                "multiplier": {
                                    "type": "Number",
                                    "description": "乘数",
                                    "example": 1000
                                }
                            }
                        },
                        "sortOrder": {
                            "type": "Integer",
                            "description": "排序序号"
                        }
                    }
                },
                "version": {
                    "type": "Integer",
                    "description": "配置版本号",
                    "example": 1
                },
                "createdBy": {
                    "type": "String",
                    "description": "创建人"
                },
                "createdAt": {
                    "type": "Date",
                    "description": "创建时间"
                },
                "updatedBy": {
                    "type": "String",
                    "description": "更新人"
                },
                "updatedAt": {
                    "type": "Date",
                    "description": "更新时间"
                }
            }
        },
        "company_rebate_import": {
            "description": "公司返点导入配置 - 定义 Excel 文件列映射和返点解析规则",
            "fields": {
                "columnMapping": {
                    "type": "Object",
                    "description": "Excel 列映射配置",
                    "required": true,
                    "properties": {
                        "xingtuId": {
                            "type": "String",
                            "description": "星图ID对应的列名",
                            "required": true,
                            "example": "星图ID"
                        },
                        "nickname": {
                            "type": "String",
                            "description": "昵称对应的列名",
                            "example": "昵称"
                        },
                        "mcn": {
                            "type": "String",
                            "description": "MCN机构对应的列名",
                            "example": "MCN"
                        },
                        "rebate": {
                            "type": "String",
                            "description": "返点数据对应的列名",
                            "example": "备注"
                        }
                    }
                },
                "rebateParser": {
                    "type": "Object",
                    "description": "返点解析规则配置",
                    "required": true,
                    "properties": {
                        "type": {
                            "type": "String",
                            "description": "解析模式",
                            "enum": ["direct", "regex", "percent"],
                            "required": true,
                            "comment": "direct=直接数值, regex=正则匹配, percent=百分比格式"
                        },
                        "pattern": {
                            "type": "String",
                            "description": "正则表达式（仅 regex 模式需要）",
                            "example": "\\|(\\d+\\.?\\d*)"
                        },
                        "multiplier": {
                            "type": "Number",
                            "description": "乘数（当数值<=1时自动乘以此值）",
                            "default": 100,
                            "example": 100
                        },
                        "groupIndex": {
                            "type": "Integer",
                            "description": "正则捕获组序号（从1开始）",
                            "default": 1,
                            "example": 1
                        }
                    }
                },
                "version": {
                    "type": "Integer",
                    "description": "配置版本号",
                    "example": 1
                },
                "createdAt": {
                    "type": "Date",
                    "description": "创建时间"
                },
                "updatedAt": {
                    "type": "Date",
                    "description": "更新时间"
                }
            }
        }
    },
    "indexes": [
        {
            "name": "idx_configType",
            "fields": { "configType": 1 },
            "description": "配置类型索引"
        },
        {
            "name": "idx_configType_platform",
            "fields": { "configType": 1, "platform": 1 },
            "unique": true,
            "sparse": true,
            "description": "平台配置唯一索引（仅对 configType=platform 生效）"
        }
    ],
    "notes": [
        "【核心设计】存储系统全局配置，通过 configType 区分不同类型的配置",
        "【平台配置】configType='platform' 存储各平台的业务配置",
        "【标签配置】configType='talent_tags' 存储达人标签的选项配置",
        "【项目配置】configType='project' 存储项目状态和交付KPI指标定义",
        "【返点导入配置】configType='company_rebate_import' 存储 Excel 列映射和返点解析规则",
        "【key/name 映射】标签配置提供 key 和 name 的双向映射",
        "【颜色配置】支持自定义背景色和文字色，用于前端展示",
        "【KPI公式】availableKPIs.formula 定义自动计算公式，支持分子/分母/乘数",
        "【版本管理】每次更新递增 version 字段"
    ],
    "examples": [
        {
            "description": "示例1：抖音平台配置",
            "data": {
                "configType": "platform",
                "platform": "douyin",
                "name": "抖音",
                "enabled": true,
                "color": "blue",
                "order": 1,
                "accountId": {
                    "label": "星图ID",
                    "placeholder": "请输入星图ID",
                    "helpText": "星图ID是抖音平台的唯一标识，可在星图后台查看"
                },
                "priceTypes": [
                    { "key": "video_60plus", "label": "60s+", "required": true, "bgColor": "#dbeafe", "textColor": "#1e40af", "order": 1 },
                    { "key": "video_21_60", "label": "21-60s", "required": true, "bgColor": "#e0e7ff", "textColor": "#4338ca", "order": 2 },
                    { "key": "video_1_20", "label": "1-20s", "required": true, "bgColor": "#ddd6fe", "textColor": "#6b21a8", "order": 3 }
                ],
                "specificFields": {
                    "uid": { "label": "抖音UID", "type": "string", "required": false }
                },
                "business": {
                    "fee": 0.05,
                    "defaultRebate": 15,
                    "minRebate": 0,
                    "maxRebate": 100
                },
                "features": {
                    "priceManagement": true,
                    "performanceTracking": true,
                    "rebateManagement": true,
                    "dataImport": true
                },
                "dbVersion": "v2",
                "version": 11,
                "createdBy": "system",
                "createdAt": "2025-11-23T15:05:45.874Z",
                "updatedAt": "2025-12-03T15:42:51.115Z"
            }
        },
        {
            "description": "示例2：达人标签配置",
            "data": {
                "configType": "talent_tags",
                "importanceLevels": [
                    { "key": "core", "name": "核心", "bgColor": "#fee2e2", "textColor": "#dc2626", "sortOrder": 1, "description": "必须维护的核心达人，不可替代" },
                    { "key": "key", "name": "重点", "bgColor": "#ffedd5", "textColor": "#ea580c", "sortOrder": 2, "description": "重点关注的优质达人" },
                    { "key": "normal", "name": "常规", "bgColor": "#dbeafe", "textColor": "#2563eb", "sortOrder": 3, "description": "正常合作的达人" },
                    { "key": "backup", "name": "备选", "bgColor": "#cffafe", "textColor": "#0891b2", "sortOrder": 4, "description": "可替代的备选达人" },
                    { "key": "observe", "name": "观察", "bgColor": "#f3f4f6", "textColor": "#6b7280", "sortOrder": 5, "description": "观察期/待评估达人" }
                ],
                "businessTags": [
                    { "key": "long_term", "name": "长期合作", "bgColor": "#dcfce7", "textColor": "#16a34a", "sortOrder": 1 },
                    { "key": "new_talent", "name": "新晋达人", "bgColor": "#f3e8ff", "textColor": "#9333ea", "sortOrder": 2 },
                    { "key": "testing", "name": "测试中", "bgColor": "#ffedd5", "textColor": "#ea580c", "sortOrder": 3 },
                    { "key": "paused", "name": "暂停合作", "bgColor": "#fee2e2", "textColor": "#dc2626", "sortOrder": 4 },
                    { "key": "price_sensitive", "name": "价格敏感", "bgColor": "#fff1e6", "textColor": "#d4380d", "sortOrder": 5 },
                    { "key": "fast_response", "name": "响应快", "bgColor": "#ecfccb", "textColor": "#65a30d", "sortOrder": 6 },
                    { "key": "high_quality", "name": "内容质量高", "bgColor": "#fef9c3", "textColor": "#ca8a04", "sortOrder": 7 },
                    { "key": "cooperative", "name": "配合度高", "bgColor": "#cffafe", "textColor": "#0891b2", "sortOrder": 8 },
                    { "key": "busy_schedule", "name": "档期紧张", "bgColor": "#fce7f3", "textColor": "#db2777", "sortOrder": 9 }
                ],
                "version": 2,
                "createdAt": "2025-12-02T08:16:27.449Z",
                "updatedAt": "2025-12-02T08:27:23.748Z",
                "createdBy": "system",
                "updatedBy": "system_upgrade"
            }
        },
        {
            "description": "示例3：项目管理配置",
            "data": {
                "configType": "project",
                "statuses": [
                    { "key": "executing", "name": "执行中", "color": "processing", "isDefault": true, "sortOrder": 1 },
                    { "key": "pending_settlement", "name": "待结算", "color": "warning", "sortOrder": 2 },
                    { "key": "settled", "name": "已结算", "color": "success", "sortOrder": 3 },
                    { "key": "closed", "name": "已完结", "color": "default", "sortOrder": 4 }
                ],
                "availableKPIs": [
                    {
                        "key": "cpm",
                        "name": "CPM",
                        "unit": "元",
                        "description": "千次播放成本",
                        "targetDirection": "lower_better",
                        "formula": { "numerator": "cost", "denominator": "plays", "multiplier": 1000 },
                        "sortOrder": 1
                    },
                    {
                        "key": "cpe",
                        "name": "CPE",
                        "unit": "元",
                        "description": "单次互动成本",
                        "targetDirection": "lower_better",
                        "formula": { "numerator": "cost", "denominator": "engagements" },
                        "sortOrder": 2
                    },
                    {
                        "key": "cpc",
                        "name": "CPC",
                        "unit": "元",
                        "description": "单次点击成本",
                        "targetDirection": "lower_better",
                        "formula": { "numerator": "cost", "denominator": "clicks" },
                        "sortOrder": 3
                    },
                    {
                        "key": "roi",
                        "name": "ROI",
                        "unit": "%",
                        "description": "投资回报率",
                        "targetDirection": "higher_better",
                        "sortOrder": 4
                    }
                ],
                "version": 1,
                "createdAt": "2025-12-07T00:00:00.000Z",
                "createdBy": "system"
            }
        },
        {
            "description": "示例4：公司返点导入配置",
            "data": {
                "configType": "company_rebate_import",
                "columnMapping": {
                    "xingtuId": "星图ID",
                    "nickname": "昵称",
                    "mcn": "MCN",
                    "rebate": "备注"
                },
                "rebateParser": {
                    "type": "regex",
                    "pattern": "\\|(\\d+\\.?\\d*)",
                    "multiplier": 100,
                    "groupIndex": 1
                },
                "version": 1,
                "createdAt": "2025-12-22T00:00:00.000Z",
                "updatedAt": "2025-12-22T00:00:00.000Z"
            }
        }
    ]
}
