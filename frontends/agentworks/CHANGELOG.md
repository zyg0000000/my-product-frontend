# AgentWorks 更新日志

## v2.2.0 (2025-11-15)

### ✨ 返点管理系统完善

#### 返点管理弹窗
- 新增独立的返点管理弹窗 (RebateManagementModal)
- Tab 结构：当前配置 / 调整历史 / 协议规则（Phase 2）
- 当前配置展示：归属类型、当前返点率、返点来源、生效日期
- 调整历史支持分页（每页 3 条记录）
- Phase 2 阶梯返点规则框架预留

#### 返点调整优化
- 移除"下次合作生效"选项（标记为暂不支持）
- 移除"调整原因"字段
- 生效时间自动使用当前时间戳（不再手动输入）
- 操作人暂时保持 'system'

#### 云函数升级 (updateTalentRebate v1.1.0)
- 实现 expiryDate 自动管理（旧配置自动标记为 expired）
- 迁移到 Date 时间戳格式（effectiveDate, expiryDate）
- 强制使用服务器当前时间（精确到毫秒）
- 添加版本管理和更新日志

#### 达人详情页优化
- 调整历史添加分页功能（每页 3 条）
- 使用共用组件统一展示格式

#### 基础功能修复
- 修复达人列表返点按钮无响应问题
- 编辑达人弹窗添加归属类型字段（野生达人/机构达人）

### 🎨 样式改进
- 统一返点率字号为 text-base（移除过大的 text-2xl）
- 弹窗中返点率保持绿色加粗突出显示
- 详情页返点率使用普通灰色样式

### 🏗️ 架构优化
- 提取共用组件 RebateHistoryList（详情页和弹窗复用）
- 添加 Phase 2 类型定义（TriggerType, RebateRule 等）
- RebateSource 类型调整：'rule' → 'rule_trigger'

### 📝 数据库 Schema 更新
- rebate_configs: effectiveDate/expiryDate 从 String 改为 Date
- rebate_rules: Phase 2 阶梯返点规则 schema（待实现）

### 🐛 Bug 修复
- 修复同一天多次调整时间冲突问题（时间戳精确到毫秒）
- 修复时间显示全是零的问题（使用服务器时间而非前端输入）
- 修复历史 tab 条件判断缺少闭合括号

---

## v2.1.0 (2025-11-15)

### ✨ 新功能

#### 价格管理
- 新增价格管理弹窗，支持新增/更新价格
- 历史价格查询和筛选（按年份/月份）
- 价格单位优化为"万元"输入，更符合业务场景
- 实时状态同步，保存后立即刷新显示

#### 列表页优化
- 操作区域改为5个徽章式按钮（价格/返点/编辑/删除/历史）
- 价格显示优化为单列纵向布局，标签+价格形式
- 达人名称支持点击跳转星图主页
- 统一价格标签宽度（w-16），视觉更整齐

#### 创建达人
- 美化创建达人页面为卡片式布局
- 平台特定字段条件显示（抖音：星图ID + UID）
- 智能字段标签（根据平台动态调整）

### 🎨 样式改进
- 操作按钮统一为徽章（badge）样式
- 价格标签使用彩色区分（60s+/20-60s/1-20s）
- 固定标签宽度并居中对齐，视觉更整齐

### 🐛 Bug 修复
- 修复价格单位转换错误（万元→分的计算）
- 修复价格保存后弹窗不刷新的问题
- 修复价格标签宽度不统一的问题
- 修复 API 路径错误（getTalents 等）
- 修复 HTTP 方法错误（GET vs POST）
- 修复 oneId 生成失败的问题（counters 为空）
- 移除创建达人页面重复的星图ID字段

### 🔧 技术改进
- PriceTypeConfig 添加 bgColor 和 textColor 配置
- PlatformSpecific 支持多ID平台架构
- 完整的错误处理和状态管理
- 类型系统增强

### 📝 待实现（标记为 TODO）
- ✅ 返点管理弹窗（v2.2.0 已完成）
- ✅ 编辑达人功能（v2.2.0 已完成）
- 删除确认弹窗
- 合作历史弹窗
- 价格趋势图表
- 阶梯返点规则管理（Phase 2）

---

## v2.0.0 (2025-11-14)

### ✨ 初始版本
- 基础达人列表页（按平台分Tab）
- 达人详情页（价格和返点历史）
- 侧边栏导航
- 类型系统和工具函数
- API 客户端封装
- Cloudflare Pages 部署配置
