# 客户管理模块规划方案

## 一、模块概述

客户管理是系统的核心模块之一，负责管理客户信息、价格策略、报价计算和收益分析。该模块与项目管理、达人管理深度集成，支持多维度的定价策略和灵活的费用配置。

## 二、核心业务架构

### 2.1 业务实体关系

```
客户 (Customer)
├── 价格策略 (PricingStrategy)
│   ├── 框架折扣 (Framework Discount)
│   ├── 项目比价 (Project Comparison)
│   └── 混合模式 (Hybrid Mode)
├── 平台配置 (Platform Config)
│   ├── 平台费用 (Platform Fees)
│   ├── 服务费 (Service Fees)
│   └── 税费设置 (Tax Settings)
├── 业务类型 (Business Type)
│   ├── 达人采买 (Talent Procurement)
│   └── 广告投流 (Ad Placement)
└── 项目关联 (Project Association)
    ├── 项目归属 (Project Ownership)
    └── 收益计算 (Revenue Calculation)
```

### 2.2 定价模式详解

#### 2.2.1 框架折扣模式
- **定义**: 长期合作客户享受的固定折扣优惠
- **适用场景**: 年度框架协议客户、战略合作伙伴
- **特点**:
  - 折扣率相对固定
  - 按合作级别或采购量设定
  - 可设置有效期

#### 2.2.2 项目比价模式
- **定义**: 每个项目单独议价和定价
- **适用场景**: 新客户、小型项目、特殊需求
- **特点**:
  - 价格灵活调整
  - 需要逐项审批
  - 可参考市场行情

#### 2.2.3 混合模式
- **定义**: 结合框架折扣和项目议价
- **适用场景**: 部分业务框架、部分业务议价
- **特点**:
  - 最大灵活性
  - 复杂度较高

### 2.3 费用结构体系

```
最终报价计算流程:
基础价格 (Base Price)
    ↓
应用平台费 (Platform Fee) [可选]
    ↓
应用折扣 (Discount)
    ↓
添加服务费 (Service Fee) [可选]
    ↓
添加税费 (Tax) [可选]
    ↓
最终报价 (Final Quote)
```

## 三、功能模块设计

### 3.1 客户信息管理

#### 基础功能
- 客户档案管理（新增、编辑、查看、删除）
- 客户分级管理（VIP、大客户、中型、小型）
- 联系人管理（多联系人支持）
- 合作状态跟踪（潜在、合作中、暂停、终止）

#### 扩展功能
- 客户画像分析
- 合作历史记录
- 沟通记录管理
- 文档附件管理

### 3.2 价格策略配置

#### 策略模板管理
- 创建策略模板
- 策略参数设置
- 策略有效期管理
- 策略审批流程

#### 客户策略关联
- 为客户分配策略
- 策略切换管理
- 策略继承规则
- 特殊策略处理

### 3.3 报价管理

#### 报价单功能
- 自动生成报价
- 手动调整价格
- 报价单审批
- 报价单导出

#### 价格计算引擎
- 多维度价格计算
- 实时成本核算
- 毛利率分析
- 价格预警机制

### 3.4 数据分析看板

#### 客户价值分析
- 客户贡献度排名
- 客户生命周期价值（CLV）
- 客户流失预警
- 客户增长趋势

#### 收益分析
- 按客户收益统计
- 按业务类型分析
- 毛利率趋势
- 成本收益对比

## 四、数据模型设计

### 4.1 核心数据表

```sql
-- 客户主表
customers {
  id: string (PK)
  code: string (唯一编码)
  name: string (客户名称)
  type: enum (客户类型)
  level: enum (客户级别)
  status: enum (合作状态)
  industry: string (所属行业)
  contacts: array (联系人列表)
  created_at: datetime
  updated_at: datetime
}

-- 价格策略表
pricing_strategies {
  id: string (PK)
  customer_id: string (FK)
  name: string (策略名称)
  type: enum (框架折扣/项目比价/混合)
  config: json (策略配置)
  valid_from: date
  valid_to: date
  status: enum (生效/失效)
}

-- 平台费用配置
platform_configs {
  id: string (PK)
  customer_id: string (FK)
  platform: enum (抖音/快手/小红书等)
  business_type: enum (达人采买/广告投流)
  fee_config: {
    platform_fee_rate: decimal (平台费率)
    include_platform_fee: boolean (是否包含平台费)
    service_fee_rate: decimal (服务费率)
    tax_rate: decimal (税率)
    include_tax: boolean (是否含税)
  }
}

-- 报价记录表
quotations {
  id: string (PK)
  customer_id: string (FK)
  project_id: string (FK)
  quotation_no: string (报价单号)
  items: array (报价明细)
  total_amount: decimal
  status: enum (草稿/待审批/已审批/已作废)
  created_at: datetime
}
```

## 五、待细化的业务规则

### 5.1 客户分级相关
- [x] **客户分级标准**：手动分配，不设置自动规则
  - 支持管理员手动设置客户级别
  - 级别可包括：VIP客户、大客户、中型客户、小客户
  - 后续可扩展自动分级规则

### 5.2 价格策略细节

#### 框架折扣规则
- [x] **折扣设置方式**：每个客户独立配置，无统一梯度
  - 针对达人采买业务的年度框架
  - 每个客户可设置不同的折扣率
  - 折扣可选择是否包含平台费

#### 项目比价规则
- [ ] 比价参考标准？
  - 市场价格
  - 历史成交价
  - 竞品报价

- [ ] 价格审批流程？
  - 审批权限矩阵
  - 特批流程
  - 价格有效期

### 5.3 平台费用明细

- [x] **平台费率设置**（仅适用于达人采买业务）：

| 平台 | 平台服务费 | 适用业务 | 实施状态 | 说明 |
|------|-----------|---------|---------|------|
| 抖音 | 5% | 达人采买 | 立即实施 | 在达人合作金额基础上额外收取 |
| 小红书 | 10% | 达人采买 | 立即实施 | 在达人合作金额基础上额外收取 |
| 快手 | 待定 | 达人采买 | 预留支持 | 后续扩展 |
| B站 | 待定 | 达人采买 | 预留支持 | 后续扩展 |
| 视频号 | 待定 | 达人采买 | 预留支持 | 后续扩展 |

**注意**：广告投流业务暂不涉及平台费，但系统需预留扩展能力

### 5.4 计费公式确认（达人采买业务）

- [x] **支付系数计算公式**：

基础公式：`支付系数 = 达人合作金额 × 平台费系数 × 折扣系数 × 服务费系数`

**关键配置选项**：
1. **折扣应用范围**：
   - 选项A：折扣包含平台费（折扣作用于含平台费的金额）
   - 选项B：折扣不包含平台费（折扣仅作用于基础金额）

2. **服务费计算基准**：
   - 选项A：折扣前计算（服务费基于原始金额）
   - 选项B：折扣后计算（服务费基于折扣后金额）

**典型场景示例**（假设：达人金额1000元，平台费5%，折扣90%，服务费10%）：

| 场景 | 折扣范围 | 服务费基准 | 计算过程 | 支付系数 |
|------|---------|-----------|---------|----------|
| 场景1 | 包含平台费 | 折扣前 | 1000×1.05×0.9×1.1 | 1039.5 |
| 场景2 | 包含平台费 | 折扣后 | 1000×1.05×0.9×1.1 | 1039.5 |
| 场景3 | 不含平台费 | 折扣前 | (1000×0.9+1000×0.05)×1.1 | 1045 |
| 场景4 | 不含平台费 | 折扣后 | (1000×0.9×1.1)+1000×0.05 | 1040 |

### 5.5 业务流程确认

- [ ] 新客户接入流程
  1. 客户信息录入
  2. 风险评估？
  3. 定价策略制定
  4. 审批流程
  5. 系统配置

- [ ] 价格调整流程
  1. 调整申请
  2. 影响分析
  3. 审批流程
  4. 生效时间
  5. 历史追溯？

### 5.6 权限管理需求

- [ ] 角色权限矩阵

| 角色 | 查看客户 | 编辑客户 | 查看价格 | 编辑价格 | 审批权限 |
|------|---------|---------|---------|---------|---------|
| 销售 | ✓ | ✓ | ✓ | 申请 | - |
| 销售经理 | ✓ | ✓ | ✓ | ✓ | 初审 |
| 财务 | ✓ | - | ✓ | - | 复审 |
| 管理层 | ✓ | ✓ | ✓ | ✓ | 终审 |

## 六、与现有系统集成

### 6.1 与项目管理集成
- 项目创建时自动关联客户
- 继承客户价格策略
- 项目收益自动归属客户
- 项目成本利润分析

### 6.2 与达人管理集成
- 达人成本 vs 客户报价对比
- 毛利率计算
- 不同客户的达人差异化定价
- 达人推荐优化

### 6.3 与财务系统集成
- 应收账款自动生成
- 发票管理
- 回款跟踪
- 对账单生成

## 七、技术实现建议

### 7.1 前端技术栈
- React + TypeScript（与现有系统一致）
- 状态管理：Zustand 或 Context API
- UI 组件：Ant Design 或现有组件库
- 图表：ECharts 或 Recharts

### 7.2 后端技术栈
- 云函数：火山引擎云函数
- 数据库：MongoDB（与现有一致）
- 缓存：价格策略缓存优化

### 7.3 关键技术点
- 价格计算引擎的性能优化
- 复杂策略规则的灵活配置
- 历史数据的版本管理
- 敏感数据的加密存储

## 八、实施路径建议

### Phase 1: 基础功能（2周）
- 客户信息管理CRUD
- 基础价格策略配置
- 简单报价生成

### Phase 2: 策略引擎（2周）
- 价格计算引擎
- 多维度策略支持
- 费用配置管理

### Phase 3: 流程集成（1周）
- 审批流程
- 与项目管理集成
- 权限管理

### Phase 4: 数据分析（1周）
- 客户价值分析
- 收益报表
- 数据看板

## 九、风险与挑战

### 技术风险
- 价格计算的准确性保证
- 大数据量下的性能问题
- 并发修改的数据一致性

### 业务风险
- 价格策略的合规性
- 历史数据迁移
- 用户培训成本

## 十、下一步行动

1. **业务规则细化**：请根据第五节的问题提供详细的业务规则
2. **优先级确认**：确认各功能模块的实施优先级
3. **原型设计**：基于确认的需求进行界面原型设计
4. **技术评审**：评估技术方案的可行性
5. **开发计划**：制定详细的开发计划和里程碑

---

**文档版本**: v1.0
**创建日期**: 2024-11-22
**最后更新**: 2024-11-22
**负责人**: 开发团队